import{G as y,b as q,u as K,r as d,j as e,L as N,c as I}from"./index-BaUkKamr.js";import{a as r}from"./index-Dq7h7Pqt.js";import{a as X}from"./index-HByl8Czo.js";import{g as Y}from"./index-D0JyTGRv.js";const Z=[{_id:"686ce89427474c070230d713",title:"React useEffect Demystified",thumbnail:"https://i.ytimg.com/vi/dGcsHMXbSOA/hqdefault.jpg"},{_id:"686ce89427474c070230d714",title:"What is Cloud Computing?",thumbnail:"https://i.ytimg.com/vi/W6NZfCO5SIk/hqdefault.jpg"},{_id:"686ce89427474c070230d710",title:"10 JavaScript Tricks You Should Know",thumbnail:"https://images.unsplash.com/photo-1518770660439-4636190af475?crop=entropy&fm=jpg&h=180&w=300"},{_id:"686ce89427474c070230d712",title:"CSS Grid Layout Tutorial",thumbnail:"https://images.unsplash.com/photo-1517433456452-f9633a875f6f?crop=entropy&fm=jpg&h=180&w=300"},{_id:"686ce89427474c070230d712",title:"Understanding Asynchronous JavaScript",thumbnail:"https://i.ytimg.com/vi/JJSoEo8JSnc/hqdefault.jpg"}];function Q(n){return y({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M885.9 490.3c3.6-12 5.4-24.4 5.4-37 0-28.3-9.3-55.5-26.1-77.7 3.6-12 5.4-24.4 5.4-37 0-28.3-9.3-55.5-26.1-77.7 3.6-12 5.4-24.4 5.4-37 0-51.6-30.7-98.1-78.3-118.4a66.1 66.1 0 0 0-26.5-5.4H273v428h.3l85.8 310.8C372.9 889 418.9 924 470.9 924c29.7 0 57.4-11.8 77.9-33.4 20.5-21.5 31-49.7 29.5-79.4l-6-122.9h239.9c12.1 0 23.9-3.2 34.3-9.3 40.4-23.5 65.5-66.1 65.5-111 0-28.3-9.3-55.5-26.1-77.7zM112 132v364c0 17.7 14.3 32 32 32h65V100h-65c-17.7 0-32 14.3-32 32z"},child:[]}]})(n)}function R(n){return y({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M885.9 533.7c16.8-22.2 26.1-49.4 26.1-77.7 0-44.9-25.1-87.4-65.5-111.1a67.67 67.67 0 0 0-34.3-9.3H572.4l6-122.9c1.4-29.7-9.1-57.9-29.5-79.4A106.62 106.62 0 0 0 471 99.9c-52 0-98 35-111.8 85.1l-85.9 311h-.3v428h472.3c9.2 0 18.2-1.8 26.5-5.4 47.6-20.3 78.3-66.8 78.3-118.4 0-12.6-1.8-25-5.4-37 16.8-22.2 26.1-49.4 26.1-77.7 0-12.6-1.8-25-5.4-37 16.8-22.2 26.1-49.4 26.1-77.7-.2-12.6-2-25.1-5.6-37.1zM112 528v364c0 17.7 14.3 32 32 32h65V496h-65c-17.7 0-32 14.3-32 32z"},child:[]}]})(n)}function ee(n){return y({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M885.9 490.3c3.6-12 5.4-24.4 5.4-37 0-28.3-9.3-55.5-26.1-77.7 3.6-12 5.4-24.4 5.4-37 0-28.3-9.3-55.5-26.1-77.7 3.6-12 5.4-24.4 5.4-37 0-51.6-30.7-98.1-78.3-118.4a66.1 66.1 0 0 0-26.5-5.4H144c-17.7 0-32 14.3-32 32v364c0 17.7 14.3 32 32 32h129.3l85.8 310.8C372.9 889 418.9 924 470.9 924c29.7 0 57.4-11.8 77.9-33.4 20.5-21.5 31-49.7 29.5-79.4l-6-122.9h239.9c12.1 0 23.9-3.2 34.3-9.3 40.4-23.5 65.5-66.1 65.5-111 0-28.3-9.3-55.5-26.1-77.7zM184 456V172h81v284h-81zm627.2 160.4H496.8l9.6 198.4c.6 11.9-4.7 23.1-14.6 30.5-6.1 4.5-13.6 6.8-21.1 6.7a44.28 44.28 0 0 1-42.2-32.3L329 459.2V172h415.4a56.85 56.85 0 0 1 33.6 51.8c0 9.7-2.3 18.9-6.9 27.3l-13.9 25.4 21.9 19a56.76 56.76 0 0 1 19.6 43c0 9.7-2.3 18.9-6.9 27.3l-13.9 25.4 21.9 19a56.76 56.76 0 0 1 19.6 43c0 9.7-2.3 18.9-6.9 27.3l-14 25.5 21.9 19a56.76 56.76 0 0 1 19.6 43c0 19.1-11 37.5-28.8 48.4z"},child:[]}]})(n)}function te(n){return y({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M885.9 533.7c16.8-22.2 26.1-49.4 26.1-77.7 0-44.9-25.1-87.4-65.5-111.1a67.67 67.67 0 0 0-34.3-9.3H572.4l6-122.9c1.4-29.7-9.1-57.9-29.5-79.4A106.62 106.62 0 0 0 471 99.9c-52 0-98 35-111.8 85.1l-85.9 311H144c-17.7 0-32 14.3-32 32v364c0 17.7 14.3 32 32 32h601.3c9.2 0 18.2-1.8 26.5-5.4 47.6-20.3 78.3-66.8 78.3-118.4 0-12.6-1.8-25-5.4-37 16.8-22.2 26.1-49.4 26.1-77.7 0-12.6-1.8-25-5.4-37 16.8-22.2 26.1-49.4 26.1-77.7-.2-12.6-2-25.1-5.6-37.1zM184 852V568h81v284h-81zm636.4-353l-21.9 19 13.9 25.4a56.2 56.2 0 0 1 6.9 27.3c0 16.5-7.2 32.2-19.6 43l-21.9 19 13.9 25.4a56.2 56.2 0 0 1 6.9 27.3c0 16.5-7.2 32.2-19.6 43l-21.9 19 13.9 25.4a56.2 56.2 0 0 1 6.9 27.3c0 22.4-13.2 42.6-33.6 51.8H329V564.8l99.5-360.5a44.1 44.1 0 0 1 42.2-32.3c7.6 0 15.1 2.2 21.1 6.7 9.9 7.4 15.2 18.6 14.6 30.5l-9.6 198.4h314.4C829 418.5 840 436.9 840 456c0 16.5-7.2 32.1-19.6 43z"},child:[]}]})(n)}function le(){const{videoId:n}=q(),{user:a}=K(),[i,M]=d.useState(null),[B,S]=d.useState(!0),[w,_]=d.useState(null),[b,c]=d.useState(!1),[j,o]=d.useState(!1),[F,m]=d.useState(0),[H,h]=d.useState(0),[k,C]=d.useState(!1),[u,D]=d.useState(""),[$,p]=d.useState([]),[A,g]=d.useState(null),[V,f]=d.useState(null),[x,v]=d.useState("");d.useEffect(()=>{S(!0),_(null),Promise.all([r.get(`https://youtube-backend-cx37.onrender.com/api/video/${n}`),r.get(`https://youtube-backend-cx37.onrender.com/api/comment/${n}`)]).then(([t,l])=>{M(t.data),m(t.data.likes||0),h(t.data.dislikes||0),p((l.data||[]).map(s=>({_id:s._id,username:s.user?.username||"Unknown",avatar:s.user?.avatar||"https://placehold.co/40x40.png?text=?",text:s.text,timestamp:s.timestamp||s.createdAt,userId:s.user?._id}))),a?(c(t.data.likedBy?.includes(a._id)),o(t.data.dislikedBy?.includes(a._id))):(c(!1),o(!1))}).catch(t=>{_("Failed to load video.")}).finally(()=>S(!1))},[n,a]);const T=async()=>{if(a)try{if(b){const t=await r.patch(`https://youtube-backend-cx37.onrender.com/api/video/${n}/unlike`,{},{headers:{Authorization:`Bearer ${a.token}`}});c(!1),m(t.data.likes),h(t.data.dislikes)}else{const t=await r.patch(`https://youtube-backend-cx37.onrender.com/api/video/${n}/like`,{},{headers:{Authorization:`Bearer ${a.token}`}});c(!0),o(!1),m(t.data.likes),h(t.data.dislikes)}}catch{alert("Failed to update like")}},U=async()=>{if(a)try{if(j){const t=await r.patch(`https://youtube-backend-cx37.onrender.com/api/video/${n}/undislike`,{},{headers:{Authorization:`Bearer ${a.token}`}});o(!1),m(t.data.likes),h(t.data.dislikes)}else{const t=await r.patch(`https://youtube-backend-cx37.onrender.com/api/video/${n}/dislike`,{},{headers:{Authorization:`Bearer ${a.token}`}});o(!0),c(!1),m(t.data.likes),h(t.data.dislikes)}}catch{alert("Failed to update dislike")}},z=async()=>{if(!(!a||!u.trim()))try{await r.post("https://youtube-backend-cx37.onrender.com/api/comment",{text:u,videoId:n},{headers:{Authorization:`Bearer ${a.token}`}});const t=await r.get(`https://youtube-backend-cx37.onrender.com/api/comment/${n}`);p((t.data||[]).map(l=>({_id:l._id,username:l.user?.username||"Unknown",avatar:l.user?.avatar||"https://placehold.co/40x40.png?text=?",text:l.text,timestamp:l.timestamp||l.createdAt,userId:l.user?._id}))),D("")}catch{alert("Failed to add comment")}},O=async t=>{if(a&&window.confirm("Delete this comment?"))try{await r.delete(`https://youtube-backend-cx37.onrender.com/api/comment/${t}`,{headers:{Authorization:`Bearer ${a.token}`}});const l=await r.get(`https://youtube-backend-cx37.onrender.com/api/comment/${n}`);p((l.data||[]).map(s=>({_id:s._id,username:s.user?.username||"Unknown",avatar:s.user?.avatar||"https://placehold.co/40x40.png?text=?",text:s.text,timestamp:s.timestamp||s.createdAt,userId:s.user?._id}))),g(null)}catch{alert("Failed to delete comment")}},J=t=>{f(t._id),v(t.text),g(null)},G=async t=>{if(!(!a||!x.trim()))try{await r.patch(`https://youtube-backend-cx37.onrender.com/api/comment/${t}`,{text:x},{headers:{Authorization:`Bearer ${a.token}`}});const l=await r.get(`https://youtube-backend-cx37.onrender.com/api/comment/${n}`);p((l.data||[]).map(s=>({_id:s._id,username:s.user?.username||"Unknown",avatar:s.user?.avatar||"https://placehold.co/40x40.png?text=?",text:s.text,timestamp:s.timestamp||s.createdAt,userId:s.user?._id}))),f(null),v("")}catch{alert("Failed to edit comment")}},P=()=>{f(null),v("")},L=180,E=i&&i.description&&i.description.length>L,W=i&&i.description?k?i.description:i.description.slice(0,L):"";return B?e.jsx("div",{style:{padding:32},children:"Loading..."}):w?e.jsx("div",{style:{padding:32,color:"red"},children:w}):i?e.jsxs("div",{className:"video-player-page light",children:[e.jsxs("div",{className:"video-player-main",children:[e.jsx("div",{className:"video-player-container",children:e.jsx("video",{className:"video-player",src:i.videoLink,poster:i.thumbnail,controls:!0})}),e.jsx("div",{className:"video-player-title",children:i.title}),e.jsxs("div",{className:"video-player-row",children:[e.jsxs("div",{className:"video-player-channel-row",children:[e.jsx(N,{to:`/channels/${i?.channel?._id}`,children:e.jsx("img",{src:i.channel?.channelPic,alt:i.channel?.channelName,className:"video-player-channel-pic"})}),e.jsx(N,{to:`/channels/${i?.channel?._id}`,children:e.jsxs("div",{className:"video-player-channel-info",children:[e.jsx("div",{className:"video-player-channel-name",children:i.channel?.channelName}),e.jsxs("div",{className:"video-player-subscribers",children:[i.channel?.subscribers?.toLocaleString()||0," subscribers"]})]})}),e.jsx("button",{className:"video-player-subscribe-btn",children:"Subscribe"})]}),a?.channelId&&e.jsxs("div",{className:"video-player-actions",children:[e.jsxs("button",{className:`video-player-action-btn${b?" active":""}`,onClick:T,disabled:!a,title:a?"":"Login to like",children:[b?e.jsx(R,{}):e.jsx(te,{}),e.jsx("span",{children:F})]}),e.jsxs("button",{className:`video-player-action-btn${j?" active":""}`,onClick:U,disabled:!a,title:a?"":"Login to dislike",children:[j?e.jsx(Q,{}):e.jsx(ee,{}),e.jsx("span",{children:H})]}),e.jsxs("button",{className:"video-player-action-btn static-btn",children:[e.jsx(X,{}),e.jsx("span",{children:"Share"})]}),e.jsxs("button",{className:"video-player-action-btn static-btn",children:[e.jsx(Y,{}),e.jsx("span",{children:"Download"})]}),e.jsx("button",{className:"video-player-action-btn static-button",children:e.jsx(I,{})})]})]}),e.jsxs("div",{className:"video-player-description",children:[e.jsxs("div",{className:"video-player-desc-meta",children:[e.jsxs("span",{className:"video-player-desc-views",children:[(i.views||0).toLocaleString()," views"]}),e.jsx("span",{className:"video-player-desc-dot",children:"â€¢"}),e.jsx("span",{className:"video-player-desc-date",children:i.uploadDate?new Date(i.uploadDate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):""})]}),e.jsxs("div",{className:"video-player-desc-text",children:[W,E&&!k&&e.jsx("span",{className:"desc-more",onClick:()=>C(!0),children:"...more"}),E&&k&&e.jsx("span",{className:"desc-less",onClick:()=>C(!1),children:" Show less"})]})]}),e.jsxs("div",{className:"video-player-comments",children:[e.jsxs("div",{className:"video-player-comments-title",children:[$.length," Comments"]}),e.jsxs("div",{className:"video-player-add-comment",children:[e.jsx("img",{src:a?.avatar||"https://placehold.co/40.png?text=?",alt:a?.username||"User",className:"video-player-comment-avatar"}),e.jsx("input",{className:"video-player-comment-input",placeholder:a?"Add a comment...":"Login to comment",value:u,onChange:t=>D(t.target.value),onKeyDown:t=>{t.key==="Enter"&&z()},disabled:!a}),e.jsx("button",{className:"video-player-comment-btn",onClick:z,disabled:!a||!u.trim(),children:"Comment"})]}),e.jsx("div",{className:"video-player-comments-list",children:$.map(t=>e.jsxs("div",{className:"video-player-comment",children:[e.jsx("img",{src:t.avatar,alt:t.username,className:"video-player-comment-avatar"}),e.jsxs("div",{className:"video-player-comment-body",children:[e.jsxs("div",{className:"video-player-comment-header",children:[e.jsx("span",{className:"video-player-comment-username",children:t.username}),e.jsx("span",{className:"video-player-comment-time",children:t.timestamp?new Date(t.timestamp).toLocaleDateString():""}),a&&t.userId===a._id&&e.jsxs("span",{className:"comment-meatball",tabIndex:0,onClick:()=>g(A===t._id?null:t._id),children:[e.jsx(I,{}),A===t._id&&e.jsxs("div",{className:"comment-menu-dropdown",children:[e.jsx("button",{className:"comment-menu-item",onClick:()=>J(t),children:"Edit"}),e.jsx("button",{className:"comment-menu-item delete",onClick:()=>O(t._id),children:"Delete"})]})]})]}),e.jsx("div",{className:"video-player-comment-text",children:V===t._id?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{className:"video-player-comment-input",value:x,onChange:l=>v(l.target.value),style:{flex:1,minWidth:0}}),e.jsx("button",{className:"video-player-comment-btn",style:{padding:"0.3rem 1rem",fontSize:"0.95rem"},onClick:()=>G(t._id),disabled:!x.trim(),children:"Save"}),e.jsx("button",{className:"video-player-comment-btn",style:{padding:"0.3rem 1rem",fontSize:"0.95rem",background:"#eee",color:"#222"},onClick:P,children:"Cancel"})]}):t.text})]})]},t._id))})]})]}),e.jsxs("div",{className:"video-player-sidebar",children:[e.jsx("div",{className:"video-player-recommend-title",children:"Up next"}),e.jsx("div",{className:"video-player-recommend-list",children:Z.map(t=>e.jsxs(N,{to:`/video/${t._id}`,className:"video-player-recommend-item",style:{display:"flex",alignItems:"center",gap:"0.8rem",textDecoration:"none"},children:[e.jsx("img",{src:t.thumbnail,alt:t.title,style:{width:80,height:48,objectFit:"cover",borderRadius:6,background:"#eee",flexShrink:0}}),e.jsx("span",{style:{color:"#222",fontWeight:500,fontSize:"1rem",lineHeight:"1.2"},children:t.title})]},t._id))})]})]}):null}export{le as default};
